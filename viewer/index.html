<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>YAML Feature Diagram</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="title">
        <h1>Diagramme YAML interactif</h1>
        <button id="sortHelpBtn" type="button" class="floating-help-btn" aria-label="Aide tri">?</button>
        <p>Drag & drop des bulles avec connexions conservees</p>
      </div>

      <div id="controlsPanel" class="controls">
        <label class="file-picker">
          Charger un YAML
          <input id="yamlFileInput" type="file" accept=".yaml,.yml" />
        </label>

        <input
          id="searchInput"
          type="search"
          placeholder="Recherche (feature, domain, relation)"
        />

        <label class="checkbox">
          <input id="showContainmentInput" type="checkbox" checked />
          Montrer les liens domain -> feature
        </label>

        <button id="layoutBtn" type="button">Recalculer layout</button>
        <button id="refreshBtn" type="button">Actualiser</button>
        <button id="saveBtn" type="button">Sauvegarder positions</button>
        <button id="resetBtn" type="button">Reset positions</button>
        <select id="viewModeSelect" aria-label="Mode d affichage">
          <option value="cluster">Mode cluster</option>
          <option value="tree_horizontal">Arborescence horizontale</option>
          <option value="tree_file">Arborescence tree (fichier)</option>
        </select>
        <select id="sortModeSelect" aria-label="Mode de tri">
          <option value="auto_tags_asc">Tri auto (tags + croissant)</option>
          <option value="alpha_asc">Tri alphabetique A-Z</option>
          <option value="alpha_desc">Tri alphabetique Z-A</option>
          <option value="tags_desc">Tri tags decroissant</option>
        </select>
        <select id="exportFormat" aria-label="Format d export">
          <option value="png">PNG</option>
          <option value="jpg">JPG</option>
          <option value="webp">WEBP</option>
          <option value="pdf">PDF</option>
        </select>
        <button id="exportBtn" type="button">Exporter</button>
        <label class="theme-switch" for="themeToggle">
          <span>Clair</span>
          <input id="themeToggle" type="checkbox" role="switch" />
          <span>Sombre</span>
        </label>
      </div>
      <button id="toggleControlsBtn" class="collapse-handle" type="button" aria-expanded="true" aria-label="Replier le panneau">▴</button>
    </header>

    <main>
      <section id="status" aria-live="polite">Chargement...</section>
      <section id="cyWrap" aria-label="Diagramme interactif">
        <section id="cy"></section>
        <button id="editNodeBtn" type="button" title="Editer ce widget" aria-label="Editer ce widget">
          ✎
        </button>
      </section>
    </main>

    <div id="editorModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editorTitle">
      <div class="modal-card">
        <h2 id="editorTitle">Edition du widget</h2>
        <p id="editorSubtitle"></p>
        <label for="editorInput">Texte</label>
        <textarea id="editorInput" rows="4" placeholder="Nouveau texte"></textarea>
        <div class="modal-actions">
          <button id="editorCancelBtn" type="button">Annuler</button>
          <button id="editorSaveBtn" type="button">Sauvegarder changements</button>
        </div>
      </div>
    </div>

    <div id="sortHelpModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="sortHelpTitle">
      <div class="modal-card">
        <h2 id="sortHelpTitle">Aide tri</h2>
        <p>Utilise des balises dans le label ou l id pour definir l ordre.</p>
        <p>Exemples: <code>[0]</code>, <code>[1]</code>, <code>[first]</code>, <code>[medium]</code>, <code>[latest]</code>.</p>
        <p>Mots-cles supportes:</p>
        <p>Francais: <code>[premier]</code>, <code>[deuxieme]</code>, <code>[troisieme]</code>, <code>[moyen]</code>, <code>[dernier]</code>, <code>[plus recent]</code>.</p>
        <p>Allemand: <code>[erste]</code>, <code>[zweite]</code>, <code>[dritte]</code>, <code>[mittel]</code>, <code>[letzter]</code>, <code>[neueste]</code>.</p>
        <p>Italien: <code>[primo]</code>, <code>[secondo]</code>, <code>[terzo]</code>, <code>[medio]</code>, <code>[ultimo]</code>, <code>[piu recente]</code>.</p>
        <div class="modal-actions">
          <button id="sortHelpCloseBtn" type="button">Fermer</button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape@3.31.2/dist/cytoscape.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
